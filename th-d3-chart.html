<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="thelma_core.html">
      

<polymer-element name="th-d3-chart" extends="th-animated" attributes="chartData chartWidth chartHeight">
  <template>
    <style>

      :host {
        display: inline-block;
        position: relative;
      }
      #chart {

      }
      #chart text {
        font-size: 14px;
      }

      #data_errors {  
        display: none;
        font-size: 14px;
        color: red;
        position: absolute;
        top: 0;
        left: 0;
      }


    </style>

    <svg id="chart"></svg>

    <ul id="data_errors">
    </ul>  
    
  </template>
  <script src="../bower_components/d3/d3.min.js"></script> 
  <script src="utility.js"></script> 
  <script>

      Polymer('th-d3-chart', Platform.mixin({
         chartData: [{label: 'medicaid', value: 20, display_value: '$20'},{label: 'gap', value: 40, display_value: '$40'},{label: 'sub', value: 10, display_value: '$10'}],  // default data just for demo 
         chartWidth: 200,
         chartHeight: 300,
         observe: {
           // chartData: this.validateChartData  // this is not working,
         },
         chartDataChanged: function() {
            this.validateChartData(this);
            
            if(this.errors.length==0) {
              this.updateData();
            }
         },
         chartWidthChanged: function() {
            this.resize();
         },
         chartHeightChanged: function() {
            this.resize();
         },
         resize: function() {

         },
         updateData: function() {

         },
         extractElementDataPoints : function() {

              //setupMargins();
              var barInfos = this.querySelectorAll('th-data-point');
              var dataFromElements = [];
              [].forEach.call(barInfos, function(dataPointEl) {
                  var dataPoint = {};
                  [].forEach.call(dataPointEl.attributes, function(attr) {
                    console.log(attr);
                    dataPoint[attr.name] = attr.value;
                  });
                  console.log(dataPoint);
                  dataFromElements.push(dataPoint);
              });

              
            if(this.validateElementDataPoints(dataFromElements)) {
              this.chartData= dataFromElements;
            }

          },
          validateElementDataPoints : function(data) {
             
              if(data.length<1) {
                return false;
              }
              return true;
          }
      }, Thelma.chartValidation, Thelma.chartUtils));


  </script>

</polymer-element>

















